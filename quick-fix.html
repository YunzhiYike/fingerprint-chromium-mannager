<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿä¿®å¤å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .status-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            border-left: 4px solid #007bff;
        }
        
        .error-card {
            border-left-color: #dc3545;
            background: #fff5f5;
        }
        
        .success-card {
            border-left-color: #28a745;
            background: #f0fff4;
        }
        
        .warning-card {
            border-left-color: #ffc107;
            background: #fffbf0;
        }
        
        .card-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-content {
            line-height: 1.6;
        }
        
        .action-buttons {
            display: flex;
            gap: 16px;
            margin-top: 32px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: #ffc107;
            color: #333;
        }
        
        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #fff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .log-container {
            background: #1e1e1e;
            color: #fff;
            border-radius: 8px;
            padding: 16px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            line-height: 1.4;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 16px;
        }
        
        .issue-list {
            list-style: none;
            padding: 0;
        }
        
        .issue-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .issue-item:last-child {
            border-bottom: none;
        }
        
        .icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ å¿«é€Ÿä¿®å¤å·¥å…·</h1>
            <p class="subtitle">è§£å†³æŒ‡çº¹æµè§ˆå™¨ç®¡ç†å™¨çš„å¸¸è§é—®é¢˜</p>
        </div>
        
        <div id="currentStatus" class="status-card">
            <div class="card-title">
                ğŸ“Š å½“å‰çŠ¶æ€
            </div>
            <div class="card-content">
                ç‚¹å‡»"å¼€å§‹è¯Šæ–­"æ¥æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...
            </div>
        </div>
        
        <div id="issuesCard" class="status-card error-card hidden">
            <div class="card-title">
                âš ï¸ å‘ç°é—®é¢˜
            </div>
            <div class="card-content">
                <ul id="issuesList" class="issue-list"></ul>
            </div>
        </div>
        
        <div id="fixesCard" class="status-card success-card hidden">
            <div class="card-title">
                âœ… å·²åº”ç”¨ä¿®å¤
            </div>
            <div class="card-content">
                <ul id="fixesList" class="issue-list"></ul>
            </div>
        </div>
        
        <div class="action-buttons">
            <button id="diagnoseBtn" class="btn btn-primary">
                ğŸ” å¼€å§‹è¯Šæ–­
            </button>
            
            <button id="restoreBtn" class="btn btn-warning">
                ğŸ“‚ ä»å¤‡ä»½æ¢å¤é…ç½®
            </button>
            
            <button id="reinstallBtn" class="btn btn-danger">
                ğŸ”„ é‡æ–°å®‰è£…æµè§ˆå™¨
            </button>
            
            <button id="openMainBtn" class="btn btn-success">
                ğŸ  æ‰“å¼€ä¸»åº”ç”¨
            </button>
        </div>
        
        <div id="logContainer" class="log-container hidden">
            <div id="logContent"></div>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        
        // DOM å…ƒç´ 
        const diagnoseBtn = document.getElementById('diagnoseBtn');
        const restoreBtn = document.getElementById('restoreBtn');
        const reinstallBtn = document.getElementById('reinstallBtn');
        const openMainBtn = document.getElementById('openMainBtn');
        const currentStatus = document.getElementById('currentStatus');
        const issuesCard = document.getElementById('issuesCard');
        const fixesCard = document.getElementById('fixesCard');
        const issuesList = document.getElementById('issuesList');
        const fixesList = document.getElementById('fixesList');
        const logContainer = document.getElementById('logContainer');
        const logContent = document.getElementById('logContent');
        
        // æ—¥å¿—å‡½æ•°
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            
            const colors = {
                info: '#61dafb',
                success: '#4caf50',
                warning: '#ff9800',
                error: '#f44336'
            };
            
            logEntry.innerHTML = `
                <span style="color: #888">[${timestamp}]</span>
                <span style="color: ${colors[type] || colors.info}">${message}</span>
            `;
            
            logContent.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            if (logContainer.classList.contains('hidden')) {
                logContainer.classList.remove('hidden');
            }
        }
        
        // è¯Šæ–­æŒ‰é’®
        diagnoseBtn.addEventListener('click', async () => {
            diagnoseBtn.disabled = true;
            diagnoseBtn.innerHTML = '<span class="loading"></span> è¯Šæ–­ä¸­...';
            
            addLog('ğŸ” å¼€å§‹ç³»ç»Ÿè¯Šæ–­...', 'info');
            
            try {
                const result = await ipcRenderer.invoke('quick-diagnose-and-fix');
                
                if (result.success) {
                    // æ›´æ–°çŠ¶æ€å¡ç‰‡
                    if (result.hasIssues) {
                        currentStatus.className = 'status-card warning-card';
                        currentStatus.querySelector('.card-title').textContent = 'âš ï¸ å‘ç°é—®é¢˜éœ€è¦å¤„ç†';
                        currentStatus.querySelector('.card-content').textContent = 
                            `æ£€æµ‹åˆ° ${result.issues.length} ä¸ªé—®é¢˜ï¼Œ${result.fixes.length} ä¸ªå·²è‡ªåŠ¨ä¿®å¤`;
                        
                        // æ˜¾ç¤ºé—®é¢˜åˆ—è¡¨
                        if (result.issues.length > 0) {
                            issuesCard.classList.remove('hidden');
                            issuesList.innerHTML = '';
                            result.issues.forEach(issue => {
                                const li = document.createElement('li');
                                li.className = 'issue-item';
                                li.innerHTML = `
                                    <span class="icon">âŒ</span>
                                    <span>${issue}</span>
                                `;
                                issuesList.appendChild(li);
                            });
                        }
                        
                        // æ˜¾ç¤ºä¿®å¤åˆ—è¡¨
                        if (result.fixes.length > 0) {
                            fixesCard.classList.remove('hidden');
                            fixesList.innerHTML = '';
                            result.fixes.forEach(fix => {
                                const li = document.createElement('li');
                                li.className = 'issue-item';
                                li.innerHTML = `
                                    <span class="icon">âœ…</span>
                                    <span>${fix}</span>
                                `;
                                fixesList.appendChild(li);
                            });
                        }
                    } else {
                        currentStatus.className = 'status-card success-card';
                        currentStatus.querySelector('.card-title').textContent = 'âœ… ç³»ç»ŸçŠ¶æ€è‰¯å¥½';
                        currentStatus.querySelector('.card-content').textContent = 
                            'æ‰€æœ‰ç»„ä»¶è¿è¡Œæ­£å¸¸ï¼Œæ²¡æœ‰å‘ç°é—®é¢˜ã€‚å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·å°è¯•å…¶ä»–ä¿®å¤é€‰é¡¹ã€‚';
                    }
                    
                    addLog('âœ… è¯Šæ–­å®Œæˆ', 'success');
                } else {
                    addLog(`âŒ è¯Šæ–­å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                addLog(`âŒ è¯Šæ–­å‡ºé”™: ${error.message}`, 'error');
            } finally {
                diagnoseBtn.disabled = false;
                diagnoseBtn.innerHTML = 'ğŸ” é‡æ–°è¯Šæ–­';
            }
        });
        
        // æ¢å¤é…ç½®æŒ‰é’®
        restoreBtn.addEventListener('click', async () => {
            if (!confirm('ç¡®å®šè¦ä»å¤‡ä»½æ–‡ä»¶æ¢å¤é…ç½®å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰é…ç½®ã€‚')) {
                return;
            }
            
            restoreBtn.disabled = true;
            restoreBtn.innerHTML = '<span class="loading"></span> æ¢å¤ä¸­...';
            
            addLog('ğŸ“‚ å¼€å§‹ä»å¤‡ä»½æ¢å¤é…ç½®...', 'info');
            
            try {
                const result = await ipcRenderer.invoke('emergency-restore-configs');
                
                if (result.success) {
                    addLog(`âœ… ${result.message}`, 'success');
                    
                    currentStatus.className = 'status-card success-card';
                    currentStatus.querySelector('.card-title').textContent = 'âœ… é…ç½®æ¢å¤æˆåŠŸ';
                    currentStatus.querySelector('.card-content').textContent = result.message;
                } else {
                    addLog(`âŒ æ¢å¤å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                addLog(`âŒ æ¢å¤å‡ºé”™: ${error.message}`, 'error');
            } finally {
                restoreBtn.disabled = false;
                restoreBtn.innerHTML = 'ğŸ“‚ ä»å¤‡ä»½æ¢å¤é…ç½®';
            }
        });
        
        // é‡æ–°å®‰è£…æµè§ˆå™¨æŒ‰é’®
        reinstallBtn.addEventListener('click', async () => {
            if (!confirm('ç¡®å®šè¦é‡æ–°å®‰è£… Chromium æµè§ˆå™¨å—ï¼Ÿè¿™ä¼šåˆ é™¤ç°æœ‰å®‰è£…å¹¶é‡æ–°ä¸‹è½½ã€‚')) {
                return;
            }
            
            reinstallBtn.disabled = true;
            reinstallBtn.innerHTML = '<span class="loading"></span> é‡æ–°å®‰è£…ä¸­...';
            
            addLog('ğŸ”„ å¼€å§‹é‡æ–°å®‰è£…æµè§ˆå™¨...', 'info');
            
            try {
                const result = await ipcRenderer.invoke('reinstall-browser');
                
                if (result.success) {
                    addLog('âœ… æµè§ˆå™¨é‡æ–°å®‰è£…æˆåŠŸ', 'success');
                    
                    currentStatus.className = 'status-card success-card';
                    currentStatus.querySelector('.card-title').textContent = 'âœ… æµè§ˆå™¨å®‰è£…æˆåŠŸ';
                    currentStatus.querySelector('.card-content').textContent = 
                        `Chromium æµè§ˆå™¨å·²é‡æ–°å®‰è£…åˆ°: ${result.executablePath}`;
                } else {
                    addLog(`âŒ é‡æ–°å®‰è£…å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                addLog(`âŒ é‡æ–°å®‰è£…å‡ºé”™: ${error.message}`, 'error');
            } finally {
                reinstallBtn.disabled = false;
                reinstallBtn.innerHTML = 'ğŸ”„ é‡æ–°å®‰è£…æµè§ˆå™¨';
            }
        });
        
        // æ‰“å¼€ä¸»åº”ç”¨æŒ‰é’®
        openMainBtn.addEventListener('click', () => {
            window.location.href = 'index.html';
        });
        
        // é¡µé¢åŠ è½½æ—¶çš„æç¤º
        addLog('ğŸ  æ¬¢è¿ä½¿ç”¨å¿«é€Ÿä¿®å¤å·¥å…·', 'info');
        addLog('ğŸ’¡ ç‚¹å‡»"å¼€å§‹è¯Šæ–­"æ¥æ£€æŸ¥ç³»ç»ŸçŠ¶æ€', 'info');
    </script>
</body>
</html> 