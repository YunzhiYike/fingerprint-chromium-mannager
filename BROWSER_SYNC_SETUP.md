# 浏览器同步功能设置指南

## 🔧 安装依赖

浏览器同步功能需要安装 `chrome-remote-interface` 包来与浏览器的调试接口通信。

### 安装方法

在项目根目录下运行以下命令：

```bash
npm install chrome-remote-interface
```

## 🚀 功能说明

### 1. 窗口布局管理

- **平铺布局**: 将选中的浏览器窗口平铺排列在屏幕上
- **重叠布局**: 将浏览器窗口以重叠方式排列
- **还原布局**: 将浏览器窗口还原到最大化状态

### 2. 操作同步

- **启用同步**: 可以监听主控浏览器的操作并同步到其他浏览器
- **主控浏览器**: 指定一个浏览器作为主控，其操作会同步到其他浏览器
- **立即同步**: 手动将指定网址同步到所有选中的浏览器

#### 支持的同步操作类型：
- 🖱️ **点击事件**: 按钮、链接、图片等元素的点击
- ⌨️ **输入事件**: 文本框、密码框、文本域的输入
- 📤 **表单提交**: 表单的提交操作
- 🔄 **选择变化**: 下拉菜单、复选框、单选按钮的选择
- ⏎ **按键事件**: Enter键的按下（特别是表单中的回车提交）
- 🌐 **页面导航**: 主控浏览器访问新页面时自动同步

## 📋 使用步骤

### 设置窗口布局

1. 在批量任务页面选中要操作的浏览器
2. 点击窗口布局控制区域的按钮：
   - 🔲 **平铺**: 智能平铺排列窗口
   - 📚 **重叠**: 重叠排列窗口
   - 🔄 **还原**: 还原窗口大小

### 启用操作同步

1. 选择要参与同步的浏览器（至少2个）
2. 在"主控浏览器"下拉框中选择一个作为主控
3. 勾选"启用同步"复选框
4. 系统会自动在主控浏览器中注入事件监听器
5. 现在您可以在主控浏览器中进行以下操作，都会自动同步：
   - 点击按钮、链接、图片等
   - 在输入框中输入文本
   - 选择下拉菜单、复选框、单选按钮
   - 提交表单
   - 按下Enter键
   - 导航到新页面

#### 同步状态指示
- 浏览器列表中会显示 **🔗同步中** 标识
- 主控浏览器会显示 **👑主控** 标识
- 控制台会显示详细的同步日志

### 手动同步

1. 选择主控浏览器和目标浏览器
2. 在"目标网址"输入框输入要访问的网址
3. 点击"立即同步"按钮

## ⚠️ 注意事项

1. **调试端口**: 浏览器必须启用调试端口才能使用同步功能
2. **网络连接**: 确保浏览器的调试端口可以正常连接
3. **系统权限**: 窗口布局功能可能需要系统权限来控制窗口位置

## 🔍 故障排除

### 问题：同步功能不可用
**解决方案**: 
1. 检查是否已安装 `chrome-remote-interface`
2. 确认浏览器启动时启用了调试端口
3. 检查防火墙是否阻止了本地连接
4. 在主控浏览器中按F12打开开发者工具，查看Console是否有同步日志

### 问题：点击和输入操作不同步
**解决方案**:
1. 确保已启用同步功能（勾选"启用同步"）
2. 检查主控浏览器的Console，确认事件监听器已注入
3. 尝试刷新主控浏览器页面，系统会重新注入监听器
4. 某些页面可能有特殊的事件处理，建议在简单页面测试

### 问题：部分元素无法同步
**解决方案**:
1. 系统会自动生成元素选择器，复杂页面可能无法准确定位
2. 优先给重要元素添加ID属性，系统会优先使用ID选择器
3. 避免在动态内容（如弹窗、动画）上进行操作
4. 某些特殊控件（如富文本编辑器）可能不支持同步

### 问题：窗口布局无效果
**解决方案**:
1. Windows: 确保PowerShell可以正常运行
2. macOS: 确保应用有辅助功能权限
3. Linux: 确保已安装 `wmctrl` 工具

### 问题：无法连接到浏览器调试端口
**解决方案**:
1. 检查浏览器是否正在运行
2. 确认调试端口号是否正确
3. 重启浏览器实例

## 📖 技术细节

- 使用 Chrome DevTools Protocol 进行浏览器通信
- 支持跨平台窗口控制（Windows/macOS/Linux）
- 实时监听浏览器导航事件
- 支持多种同步操作类型（导航、脚本执行、点击、输入等） 